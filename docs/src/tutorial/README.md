# Tutorial (JavaScript)

::: danger

Note: This site is work-in-progress and the mainnet library is currently in a prototype stage. 
Things may and will change randomly. There is no backward compatibility guarantee yet, 
even though we try not to break things too often. Use at your own risk. To see the old site with the full plan 
(yet to be implemented), go [here](https://web.archive.org/web/20200810182937/https://mainnet.cash/).

:::

::: tip A working demo

You can see a fully working demo [here](https://jsfiddle.net/ghn19jmu/2/) and a video of it [here](https://www.youtube.com/watch?v=6Z4ef2Isod4)

:::

<!-- Your stack: Browser + IndexedDB PHP Other -->

## Let's get programming

Note that this tutorial describes `Browser + IndexedDB` approach, which means that the wallets will be created 
and persisted inside of a user browser.

To get started using Bitcoin Cash on your site, include this tag in your `<head>` section:

```html
<script src="https://cdn.mainnet.cash/mainnet-0.0.1-rc.3.js"
 integrity="sha384-C8lwo1llqjqJUHz/M0eTiQzqGqBhKKme3Cz4baMSvpX7vTBpM0ZmwSEzqr11mQsk"
 crossorigin="anonymous"></script>
```

<!-- 
sha matching:
curl https://cdn.mainnet.cash/mainnet-0.0.1-rc.3.js | openssl dgst -sha384 -binary | openssl base64 -A 
-->

Now, you can create a test wallet:

```js
const wallet = await TestNetWallet.newRandom();
```

This wallet will not be persisted, if a user closes his browser, it's gone forever. We'll explain below how to make 
persistent wallets.

To create a persistent wallet:

```js
const wallet = await TestNetWallet.named('buyer');
```

`buyer` is an optional name for the wallet, it saves data in user's browser for future re-use.

::: tip What is TestNet?

`TestNet` is where you test your application. TestNet money has no price. Opposite of TestNet is `MainNet`, 
which is what people usually mean when they talk about Bitcoin Cash network. 

:::

To create a MainNet wallet (Bitcoin Cash production network): 

```js
const wallet = await Wallet.newRandom();
```

::: tip Why named wallets?

For in-browser wallet they are used to saved the private key generated by the browser, so that you 
can run ```await Wallet.named(`user`)``` and always get the same wallet back,
but it's better to run ```await Wallet.named(`user:${id}`)``` and add the `ID` of the user, 
so that if the same browser multiple users use the same browser, they'll all get their own wallet.

:::

If you want to create a wallet from WIF (private key), use this call:

``` js
const wallet = Wallet.fromWIF('.....');
```

::: tip TestNet money
We will need some test money to move around, you can get some at [https://faucet.fullstack.cash/](https://faucet.fullstack.cash/)

Note: If you need a wallet that supports the TestNet, download [Electron Cash](https://electroncash.org/) and 
run it using `electron-cash --testnet` flag. For example, on MacOS that would be:

`/Applications/Electron-Cash.app/Contents/MacOS/Electron-Cash --testnet`
:::

## Sending money

Let's create another wallet and send some of our money there:

```js
const seller = new TestNetHdWallet('seller');

await wallet.send([
    [seller.depositAddress(), 0.01, 'USD'],
]);
```

Note that you can send to many addresses at once.

Let's print the balance of the seller's wallet:

```js
console.log(await seller.getBalance('USD'));
// 0.01
```

Great! You've just made your first transaction!

## Waiting for a transaction

Let's say you want to display a QR code for you user to pay you money and show an alert when money arrives?

Currently, the only way to wait for a tx is to poll the balance (this will improve later):

```js
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

while((await wallet.getBalance('usd')) < 1.0) {
  await sleep(0.1);
}

alert('Transaction has arrived!');
````

## QR codes

You can also display deposit QR codes. Create a placeholder first:

```html
<p style="text-align: center;">
    <img src="https://cdn.mainnet.cash/wait.svg" style="width: 15em;" id="deposit">
</p>
```

Then you can replace it with an actual QR code of the deposit address:

```js
document.querySelector('#deposit').src = wallet.getDepositQr().src;
```

## Escrow contracts

Done, but not yet documented...

## CashScript

Done, but not yet documented...

## RegTest wallets

TODO: How to run the local development environment

RegTest (local development) wallets, use this:

::: tip What is RegTest?

You might also hear about `RegTest` mode, which is when you run your Bitcoin Cash node 
locally and you can get as many test coins as you need, but they exist on your machine only. 
RegTest wallets are supported by mainnet library.

:::

```js
const wallet = await RegTestWallet.newRandom();
```

To be continued...
